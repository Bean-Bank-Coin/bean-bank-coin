name: Database Migration

on:
  push:
    branches:
      - main

jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      
      - name: Install Flyway
        run: |
          wget -qO- https://repo1.maven.org/maven2/org/flywaydb/flyway-commandline/8.5.1/flyway-commandline-8.5.1-linux-x64.tar.gz | tar xvz
          sudo ln -s $(pwd)/flyway-8.5.1/flyway /usr/local/bin/flyway

      - name: Run Flyway Migration
        run: flyway -configFiles="./flyway.conf" migrate
        env:
          DB_NAME: ${{ secrets.DB_NAME }}
          DB_USERNAME: ${{ secrets.DB_BUILD_USERNAME }}
          DB_PASSWORD: ${{ secrets.DB_BUILD_PASSWORD }}
          DB_BUILD_URL: ${{ secrets.DB_BUILD_URL }}
